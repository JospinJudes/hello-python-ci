{% extends "base.html" %}

{% block content %}
<h1 class="title gradient-text" style="text-align:center; margin-bottom:2rem;">Post a Tweet</h1>

     <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            {% if category == 'success' %}
                <!-- Message de succès vert -->
                <div class="notification" style="
                    border-radius: 12px;
                    padding: 0.8rem 1rem;
                    margin-bottom: 1.5rem;
                    font-weight: 600;
                    text-align: center;
                    background: rgba(56, 161, 105, 0.85);
                    color: white;
                ">
                    {{ message }}
                </div>
            {% else %}
                <!-- Messages d'erreur -->
                <div class="notification" style="
                    border-radius: 12px; 
                    padding:0.8rem 1rem;
                    margin-bottom:1.5rem;
                    font-weight:600;
                    text-align:center;
                    background: rgba(255,37,37,0.85); 
                    color:white;
                ">
                    {{ message }}
                </div>
            {% endif %}
            {% endfor %}
        {% endif %}
        {% endwith %}

         <!-- Script pour effacer automatiquement les messages de succès -->
        <script>
        document.querySelectorAll('.notification').forEach(msg => {
            // On ne supprime que les messages verts (success)
            if (msg.style.background.includes('56, 161, 105')) {
                setTimeout(() => {
                    msg.style.opacity = 0;
                    setTimeout(() => msg.remove(), 500);
                }, 3000); // disparaît après 3s
            }
        });
        </script>


<div class="container"
     style="max-width:500px; margin:0 auto; padding:2rem; background:#fff;
            border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1);">

    <form method="POST" novalidate>
        {{ form.hidden_tag() }}

        <!-- Zone de texte -->
        <div class="field">
            {{ form.content.label(class="label") }}
            <div class="control">
                {{ form.content(id="tweet-content",
                class="textarea",
                rows=4,
                style="border-radius:10px; border:1px solid #ddd; padding:0.75rem; font-size:1rem; resize:none; height:120px;") }}
            </div>
        </div>

        <!-- Compteur de caractères -->
        <div id="char-counter" style="text-align:right; color:gray; font-size:0.9rem; margin-top:0.25rem;">
            0 / 280
        </div>

        <!-- Boutons côte à côte -->
        <div class="field" style="margin-top:2rem;">
            <div style="display:flex; gap:1rem;">
                <!-- Return -->
                <a href="{{ url_for('main.profile') }}"
                   class="navbar-button"
                   style="flex:1; text-align:center; font-size:1rem; font-weight:500;
                          padding:0.7rem 0; border-radius:25px;
                          background: linear-gradient(135deg,#ff6a00,#ffd500);
                          color:white; text-decoration:none; box-shadow:0 3px 8px rgba(255,165,0,0.3);
                          transition: transform 0.2s ease, box-shadow 0.2s ease;">
                    Return
                </a>

                <!-- Post -->
                <button type="submit"
                        class="navbar-button"
                        style="flex:1; font-size:1rem; font-weight:500;
                               padding:0.7rem 0; border-radius:25px;
                               background: linear-gradient(135deg,#ff416c,#ff4b2b);
                               color:white; border:none; cursor:pointer;
                               box-shadow:0 3px 8px rgba(255,75,43,0.3);
                               transition: transform 0.2s ease, box-shadow 0.2s ease;">
                    Post
                </button>
            </div>
        </div>
    </form>

</div>

<!-- Script compteur de caractères -->
<script>
const textarea = document.getElementById('tweet-content');
const counter = document.getElementById('char-counter');
const maxChars = 280;

textarea.addEventListener('input', () => {
    const length = textarea.value.length;
    counter.textContent = `${length} / ${maxChars}`;
    counter.style.color = length > maxChars ? 'red' : 'gray';
});
</script>

{% endblock %}
