{% extends "base.html" %}

{% block title %}Notifications{% endblock %}

{% block content %}

<h1 class="title gradient-text has-text-centered mb-5">
    Notifications
</h1>

<div class="container" style="max-width:700px; margin:0 auto;">

    {% if notifications|length == 0 %}
        <div class="tweet-card" style="text-align:center;">
            <p style="color:#777;">No notifications yet.</p>
        </div>
    {% endif %}

    {% for n in notifications %}
    <div class="tweet-card">

        <div style="display:flex; align-items:flex-start; gap:0.8rem;">

            <!-- Icone selon type -->
            {% if n.type == "follow" %}
            <i class="fas fa-user-plus" style="color:#ff416c; font-size:1.3rem; flex-shrink:0;"></i>
            {% elif n.type == "like" %}
            <i class="fas fa-heart" style="color:#e0245e; font-size:1.3rem; flex-shrink:0;"></i>
            {% elif n.type == "comment" %}
            <i class="fas fa-comment" style="color:#ff6a00; font-size:1.3rem; flex-shrink:0;"></i>
            {% endif %}

            <div style="flex:1;">
                <!-- Texte notification -->
                {% if n.type == "follow" %}
                    <strong>{{ n.actor }}</strong> is now following you.
                {% elif n.type == "like" %}
                    <strong>{{ n.actor }}</strong> liked your post.
                {% elif n.type == "comment" %}
                    <strong>{{ n.actor }}</strong> commented:
                    <em>"{{ n.payload.comment }}"</em>
                {% endif %}

                <!-- Date -->
                <div class="tweet-date" style="font-size:0.8rem; margin-top:0.2rem;">
                    {{ n.created_at }}
                </div>
            </div>

        </div>

    </div>
    {% endfor %}
</div>

<!-- Mode sombre CSS spécifique notifications -->
<style>
/* Tweet-card déjà gère sombre, mais on ajuste le texte */
body.dark-theme .tweet-card strong {
    color: #fff; /* pseudo ou acteur blanc en sombre */
}
body.dark-theme .tweet-card em {
    color: #e0e0e0; /* texte italique clair */
}
body.dark-theme .tweet-card .tweet-date {
    color: #aaa;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    try {
        await fetch('{{ url_for("main.mark_all_notifications_read") }}', {
            method: 'POST',
            credentials: 'same-origin',
            headers: {'Content-Type': 'application/json'}
        });
    } catch (err) {
        console.error('mark all read failed', err);
    }

    const badge = parent?.document?.getElementById ? parent.document.getElementById('notif-count') : document.getElementById('notif-count');
    if (badge) { badge.style.display = 'none'; }

    try {
        if (typeof fetchCount === 'function') { setTimeout(fetchCount, 500); }
    } catch(e){ console.error('refresh fetchCount failed', e); }
});
</script>

{% endblock %}
