{% extends "base.html" %}

{% block content %}
<h1 class="title gradient-text has-text-centered mb-5">
    #{{ tag }}
</h1>

<div class="container" style="max-width:700px; margin:0 auto;">

    {% if tweets %}
        {% for tweet in tweets %}
        <div class="tweet-card">

            <!-- Header -->
            <div class="tweet-header">
                <div class="tweet-author">
                    <strong>@{{ tweet.user.name }}</strong>
                    <span class="tweet-date">{{ tweet.timestamp.strftime('%d/%m/%Y %H:%M') }}</span>
                </div>

                {% if current_user.id == tweet.user_id %}
                <form action="{{ url_for('main.delete_tweet', tweet_id=tweet.id) }}" method="POST"
                      onsubmit="return confirm('Are you sure you want to delete this tweet?');">
                    <button type="submit" class="delete-btn">
                        <i class="fas fa-trash"></i>
                    </button>
                </form>
                {% endif %}
            </div>

            <!-- Content -->
            <div class="tweet-content">
                {% for word in tweet.content.split() %}
                    {% if word.startswith('#') %}
                        <a href="{{ url_for('main.hashtag', tag=word[1:]) }}" class="hashtag">{{ word }}</a>
                    {% else %}
                        {{ word }}
                    {% endif %}
                    &nbsp;
                {% endfor %}
            </div>

            <!-- Actions -->
            <div class="tweet-actions">
                <form action="{{ url_for('main.like_tweet', tweet_id=tweet.id) }}" method="POST">
                    <button type="submit" class="like-btn {% if tweet.id in current_user.liked_tweet_ids %}liked{% endif %}">
                        <i class="fas fa-heart"></i> {{ tweet.likes_count }}
                    </button>
                </form>
            </div>

            <!-- Comment Form -->
            <form action="{{ url_for('main.comment_tweet', tweet_id=tweet.id) }}" method="POST" class="comment-section">
                <input type="text" name="comment_content" placeholder="Add a comment..." class="comment-input">
                <button type="submit" class="comment-btn">
                    <i class="fas fa-reply"></i>
                </button>
            </form>

            <!-- Comments -->
            {% if tweet.comments %}
            <div class="comments-block">
                {% for comment in tweet.comments %}
                <div class="comment-item">
                    <strong>@{{ comment.user.name }} :</strong>
                    <span class="comment-text">
                        {% for word in comment.content.split() %}
                            {% if word.startswith('#') %}
                                <a href="{{ url_for('main.hashtag', tag=word[1:]) }}" class="hashtag">{{ word }}</a>
                            {% else %}
                                {{ word }}
                            {% endif %}
                            &nbsp;
                        {% endfor %}
                    </span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

        </div>
        {% endfor %}
    {% else %}
        <p class="has-text-centered">No tweets found for this hashtag.</p>
    {% endif %}

</div>

<!-- Mode sombre CSS -->
<style>
/* Pseudo utilisateur */
body.dark-theme .tweet-author strong {
    color: #fff;
}
body:not(.dark-theme) .tweet-author strong {
    color: #000;
}

/* Date du tweet */
body.dark-theme .tweet-date { color: #aaa; }
body:not(.dark-theme) .tweet-date { color: #888; }

/* Contenu commentaires */
body.dark-theme .comment-item { background: #2c2c2c; color: #e0e0e0; }
body:not(.dark-theme) .comment-item { background: #f1f3f6; color: #555; }

/* Hashtags */
body.dark-theme .hashtag { color: #ff416c; }
body:not(.dark-theme) .hashtag { color: #ff416c; }

/* Input commentaire */
body.dark-theme .comment-input { background: #2c2c2c; color: #e0e0e0; border: 1px solid #555; }
body:not(.dark-theme) .comment-input { background: #fff; color: #333; border: 1px solid #ddd; }

/* Nom auteur commentaire */
body.dark-theme .comment-item strong { color: #cccccc; }
body:not(.dark-theme) .comment-item strong { color: #444444; }
</style>

{% endblock %}
