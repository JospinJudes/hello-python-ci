{% extends "base.html" %}

{% block content %}

<!-- Flash messages spécifiques au profil -->
{% with messages = get_flashed_messages(category_filter=["bio"]) %}
  {% if messages %}
    <div class="flash-messages" style="margin-bottom: 1rem;">
      {% for message in messages %}
        <div class="alert" style="background-color: #4caf50; color: white; padding: 0.75rem 1rem; border-radius: 0.5rem; margin-bottom: 0.5rem;">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- Encadré profil avec marge top -->
<div class="profile-card" style="margin-top: 2rem;">
    <!-- Ligne nom + boutons -->
    <div class="profile-header" style="display: flex; justify-content: space-between; align-items: center;">
        <h1 style="margin: 0; font-size: 2rem; font-weight: 700; text-align: left;">
            @{{ user.name | replace(' ', '') }}
        </h1>

        <div style="display: flex; gap: 0.5rem; flex-wrap: nowrap;">
            <button id="edit-bio-btn" class="white-btn profile-btn">
                Edit Bio
            </button>
            <a href="{{ url_for('main.tweet') }}" class="white-btn profile-btn">
                Post
            </a>
        </div>
    </div>

    <!-- Bio -->
    <p id="bio-text" class="bio-text">
        {{ user.bio or "This user hasn’t written a bio yet." }}
    </p>

    <!-- Compteurs Following / Follower -->
    <div class="follow-stats" style="display: flex; gap: 1.5rem; margin-top: 0.5rem;">
        <div>
            <strong id="following-count" style="color: white;">0</strong> <span style="font-weight: 600;">Following</span>
        </div>
        <div>
            <strong id="followers-count" style="color: white;">0</strong> <span style="font-weight: 600;">Followers</span>
        </div>
    </div>

    <!-- Formulaire édition bio -->
    <form id="edit-bio-form" class="bio-form" action="{{ url_for('main.edit_bio') }}" method="POST" style="display: none; margin-top: 0.5rem;">
        <textarea name="bio" rows="3">{{ user.bio or '' }}</textarea>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
            <button type="submit" class="white-btn profile-btn">Save</button>
            <button type="button" id="cancel-bio-btn" class="cancel-btn profile-btn">Cancel</button>
        </div>
    </form>
</div>

<!-- Tweets récents -->
<div class="tweets-list" style="margin-top: 2rem;">
    {% if tweets %}
        {% for tweet in tweets %}
            <div class="tweet-card" style="padding: 1rem; border-bottom: 1px solid #ddd;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <strong style="font-size: 1.05rem;">@{{ tweet.user.name }}</strong>
                    <small style="color: gray; font-size: 0.85rem;">
                        {{ tweet.timestamp.strftime('%d/%m/%Y %H:%M') }}
                    </small>
                </div>
                <p style="font-size: 0.95rem; line-height: 1.6; margin: 0;">{{ tweet.content }}</p>
            </div>
        {% endfor %}
    {% else %}
        <p style="margin-top: 1rem; font-style: italic; color: gray;">No tweets yet.</p>
    {% endif %}
</div>

<script>
// Toggle édition bio
const editBtn = document.getElementById('edit-bio-btn');
const cancelBtn = document.getElementById('cancel-bio-btn');
const form = document.getElementById('edit-bio-form');
const bioText = document.getElementById('bio-text');

editBtn.addEventListener('click', () => {
    form.style.display = 'block';
    editBtn.style.display = 'none';
    bioText.style.display = 'none';
});

cancelBtn.addEventListener('click', () => {
    form.style.display = 'none';
    editBtn.style.display = 'inline-flex';
    bioText.style.display = 'block';
});

// Faire disparaître les flash messages après 3 secondes
const flashMessages = document.querySelectorAll('.flash-messages .alert');
flashMessages.forEach(msg => {
    setTimeout(() => {
        msg.style.transition = "opacity 0.5s";
        msg.style.opacity = 0;
        setTimeout(() => msg.remove(), 500);
    }, 3000);
});
</script>

{% endblock %}
